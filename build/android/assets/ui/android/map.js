function initWindowEvent(e){e.addEventListener("focus",function(){hideBar(e)})}function hideBar(e){var n=e.activity.actionBar;Ti.API.info("actionBar:"+n),"undefined"!=typeof n&&n.hide()}function initWindow(){return Ti.UI.createWindow()}function initModule(){return require("ti.mapsforge")}function initVar(){var e={Marker:{dest:0},Gps:{lat:0,lng:0,heading:0,accuracy:0,speed:0},Line:{route:0},Nodes:{}};return e}function initMap(e,n){var i=n.createMapsforgeView({scalebar:!0,minZoom:5,maxZoom:20,centerLatlng:[-43.524551,172.58346],zoomLevel:12,debug:!1});return e.add(i),e.open(),i}function addOfflineMapLayer(e){e.addLayer({name:"osm",path:"osmdroid/maps/nz/nz.map"})}function initNav(e){e.load("/osmdroid/maps/nz/")}function initMapListener(e,n,i){Ti.App.addEventListener("viewCreated",function(){Ti.API.info("mapCreated: received by js"),addOfflineMapLayer(i),addActionListeners(n,i)})}function addActionListeners(e,n){Ti.App.addEventListener("clicked",function(e){var n=(Ti.App.Android.R.drawable.marker_tap,[e.lat,e.lng]);Ti.API.info("clicked"+n)}),Ti.App.addEventListener("longclicked",function(i){if(Ti.API.info("longclicked("+i.lat+","+i.lng+")"),0==ALL.Gps.lat||0==ALL.Gps.lng)Ti.API.info("GPS not available");else{var a=[ALL.Gps.lat,ALL.Gps.lng],r=[i.lat,i.lng];navi(e,n,a,r),removePrevDestMarker(n),addMarker(n,r),addNodeMarkers()}})}function removePrevDestMarker(e){var n=ALL.Marker.dest;0!==n&&e.removeLayer(n)}function addMarker(e,n){var i=e.createMarker({iconPath:Ti.App.Android.R.drawable.marker_tap_long,latlng:n});ALL.Marker.dest=i.id}function addNodeMarkers(){ALL.Nodes.length;for(node in ALL.Nodes)node.pts,node.sign}function navi(e,n,i,a){var r={weighting:"fastest",vehicle:"car",from:i,to:a,debug:!1};e.getRouteAsyncCallback(r,function(e){if(0==e.error){var i=ALL.Line.route;0!==i&&n.removeLayer(i);var a=n.createPolyline({latlngs:e.pts,color:"blue",strokeWidth:10});ALL.Line.route=a.id,ALL.Nodes=e.nodes}})}var ALL=initVar(),win=initWindow();initWindowEvent(win);var mf=initModule(),map=initMap(win,mf);initMapListener(win,mf,map),initNav(mf),Ti.include("../../util/gps.js");