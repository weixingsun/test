function initWindow(){return Ti.UI.createWindow()}function initModule(){return require("ti.mapsforge")}function initVar(){var e={Marker:{dest:0},Gps:{lat:0,lng:0,heading:0,accuracy:0,speed:0},Line:{route:0},Nodes:{}};return e}function hideBar(e){var i=e.activity.actionBar;"undefined"!=typeof i&&i.hide()}function initMap(e,i){var a=i.createMapsforgeView({scalebar:!0,minZoom:5,maxZoom:20,centerLatlng:[-43.524551,172.58346],zoomLevel:12,debug:!1});return e.add(a),e.open(),Ti.API.info("mapView: "+JSON.stringify(a)),a}function addOfflineMapLayer(e){e.addLayer({name:"osm",path:"osmdroid/maps/nz/nz.map"})}function initNav(e){e.load("/osmdroid/maps/nz/")}function addListeners(){Ti.App.addEventListener("clicked",function(e){Ti.App.Android.R.drawable.marker_tap,[e.lat,e.lng]}),Ti.App.addEventListener("longclicked",function(e){Ti.API.info("longclicked("+e.lat+","+e.lng+")");var i=[-43.524551,172.58346],a=[e.lat,e.lng];navi(i,a),removePrevDestMarker(),addMarker(a)})}function removePrevDestMarker(){var e=ALL.Marker.dest;0!==e&&mapView.removeLayer(e)}function addMarker(e){var i=mapView.createMarker({iconPath:Ti.App.Android.R.drawable.marker_tap,latlng:e});ALL.Marker.dest=i.id}function navi(e,i){var a={weighting:"fastest",vehicle:"car",from:e,to:i,debug:!1};mf.getRouteAsyncCallback(a,function(e){if(0==e.error){var i=ALL.Line.route;0!==i&&mapView.removeLayer(i);var a=mapView.createPolyline({latlngs:e.pts,color:"blue",strokeWidth:10});ALL.Line.route=a.id,ALL.Nodes=e.nodes}})}var ALL=initVar(),win=initWindow(),mf=initModule(),map=initMap(win,mf);initNav(mf),addListeners(),addOfflineMapLayer(map),hideBar(win);