function findSavedMarker(e){for(var i=map.getZoomLevel(),a=JSON.parse(Ti.App.Properties.getString("SavedPlaceMarkers")),t=0;t<a.length;t++){var r=a[t].latlng,n=distance(r[0],r[1],e[0],e[1]),o=tapRange(i,n);if(o)return a[t]}return null}function tapRange(e,i){var a=!1;switch(e){case 20:a=3>i?!0:!1;break;case 19:a=5>i?!0:!1;break;case 18:a=10>i?!0:!1;break;case 17:a=20>i?!0:!1;break;case 16:a=30>i?!0:!1;break;case 15:a=50>i?!0:!1;break;case 14:a=150>i?!0:!1;break;case 13:a=300>i?!0:!1;break;case 12:a=500>i?!0:!1;break;case 11:a=1e3>i?!0:!1;break;case 10:a=2e3>i?!0:!1;break;case 10:a=4e3>i?!0:!1;break;case 9:a=6e3>i?!0:!1;break;case 8:a=1e4>i?!0:!1;break;case 7:a=2e4>i?!0:!1;break;case 6:a=3e4>i?!0:!1;break;case 5:a=4e4>i?!0:!1;break;case 4:a=5e4>i?!0:!1}return a}function createSavedPlaceTable(){var e=Ti.Database.open("wx_map");e.execute("CREATE TABLE IF NOT EXISTS saved_places(lat varchar(20), lng varchar(20), name varchar(100));"),e.close()}function showAllSavedPlaceMarkers(){for(var e=selectAllPlacesDB(),i=[],a=0;a<e.length;a++){var t=[e[a].lat,e[a].lng],r=Ti.App.Android.R.drawable.star_red_24,n=addMarker(map,t,r),o={mk:n,latlng:t};i.push(o)}var s=JSON.stringify(i);Ti.App.Properties.setString("SavedPlaceMarkers",s),Ti.API.info("SavedPlaceMarkers="+s)}function removeSavedPlaceMarker(e){for(var i=Ti.App.Properties.getString("SavedPlaceMarkers"),a=JSON.parse(i),t=0;t<a.length;t++){var r=a[t].latlng,n=a[t].mk;JSON.stringify(r)==JSON.stringify(e)&&(removeLayer(n),a.removeAt(t))}var i=JSON.stringify(a);Ti.API.info("removeSavedPlaceMarker="+i),Ti.App.Properties.setString("SavedPlaceMarkers",i)}function addSavedPlaceMarker(e){var i=Ti.App.Properties.getString("SavedPlaceMarkers"),a=JSON.parse(i),t=Ti.App.Android.R.drawable.star_red_24,r=addMarker(map,e,t),n={mk:r,latlng:e};a.push(n);var i=JSON.stringify(a);Ti.API.info("SavedPlaceMarkers="+i),Ti.App.Properties.setString("SavedPlaceMarkers",i)}function selectAllPlacesDB(){var e,i,a=[];try{for(e=Ti.Database.open("wx_map"),i=e.execute("select * from saved_places;");i.isValidRow();)a.push({lat:i.fieldByName("lat"),lng:i.fieldByName("lng"),name:i.fieldByName("name")}),i.next();Ti.API.info("selectAllPlacesDB()row#"+i.rowCount)}finally{null!==i&&i.close(),null!==e&&e.close()}return a}function selectASavedPlace(e){var i,a=[];try{i=Ti.Database.open("wx_map");var t=JSON.parse(e),r=i.execute("select * from saved_places where lat=? and lng=? ",t);if(r.rowCount<1)return null;for(;r.isValidRow();)a.push({lat:r.fieldByName("lat"),lng:r.fieldByName("lng"),name:r.fieldByName("name")}),r.next()}finally{null!==r&&r.close(),null!==i&&i.close()}return a[0]}function isSavedPlacesDB(e){var i=!1,a=selectASavedPlace(e);return null!==a&&(i=!0),i}function addSavedPlaceDB(e){var i;try{i=Ti.Database.open("wx_map");var a=[e.lat,e.lng,e.name];i.execute("insert into saved_places(lat,lng,name) values(?,?,?)",a)}finally{null!==i&&i.close()}Ti.API.info("addSavedPlaceDB():"+JSON.stringify(e))}function removeSavedPlaceDB(e){var i;try{i=Ti.Database.open("wx_map");var a=[e.lat,e.lng];i.execute("delete from saved_places where lat=? and lng=?",a)}finally{null!==i&&i.close()}Ti.API.info("removeSavedPlaceDB():"+JSON.stringify(e))}function updateSavedPlaceDB(e){var i;try{i=Ti.Database.open("wx_map");var a=[e.lat,e.lng];i.execute("delete from saved_places where lat=? and lng=?",a)}finally{null!==i&&i.close()}Ti.API.info("removeSavedPlaceDB():"+JSON.stringify(e))}