function findSavedMarker(e){for(var t=Math.round(map.getZoomLevel()),a=getTapRange(t),r=selectAllPlacesDB(),i=0;i<r.length;i++){var o=r[i].lat,n=r[i].lng,s=distance(o,n,e[0],e[1]);if(a>s)return r[i]}return null}function getDiffLat(e){return e/110574}function getDiffLng(e,t){return e/(111320*Math.cos(t))}function getTapRange(e){switch(e){case 20:return 3;case 19:return 5;case 18:return 10;case 17:return 20;case 16:return 30;case 15:return 50;case 14:return 150;case 13:return 300;case 12:return 500;case 11:return 1e3;case 10:return 2e3;case 10:return 4e3;case 9:return 6e3;case 8:return 1e4;case 7:return 2e4;case 6:return 3e4;case 5:return 4e4;case 4:return 5e4}}function tapRange(e,t){var a=!1;return t<getTapRange(e)?!0:a}function createSavedPlaceTable(){var e=Ti.Database.open("wx_map");e.execute("CREATE TABLE IF NOT EXISTS saved_places(lat varchar(20), lng varchar(20), name varchar(100));"),e.execute("CREATE TABLE IF NOT EXISTS saved_marker_id(lat varchar(20), lng varchar(20), id varchar(100));"),e.close()}function showAllSavedPlaceMarkers(){deleteSavedPlaceMarkerDB("1=1");var e=selectAllPlacesDB();if(null!=e)for(var t=0;t<e.length;t++){var a=Ti.App.Android.R.drawable.star_red_24,r=[e[t].lat,e[t].lng],i="saved_"+e[t].lat+"_"+e[t].lng,o=addMarker(i,r,a,!1),n={lat:r[0],lng:r[1],id:o};addSavedPlaceMarkerDB(n)}}function compare(e,t){var a=Number(e.toString().split(",")[0]),r=Number(e.toString().split(",")[1]),i=Number(t.toString().split(",")[0]),o=Number(t.toString().split(",")[1]);return a.toFixed(6)==i.toFixed(6)&&r.toFixed(6)==o.toFixed(6)?!0:!1}function removeSavedPlaceMarker(e){var t=selectASavedPlaceMarkerDB(JSON.stringify(e)),a="lat='"+t.lat+"' and lng='"+t.lng+"'";deleteSavedPlaceMarkerDB(a),removeMarker(t.id)}function addSavedPlaceMarker(e){var t=Ti.App.Android.R.drawable.star_red_24,a="saved_"+e[0]+"_"+e[1],r=addMarker(a,e,t,!1),i={lat:e[0],lng:e[1],id:r};addSavedPlaceMarkerDB(i)}function selectAllPlacesDB(){var e="saved_places",t="lat,lng,name",a="1=1";return selectDB("wx_map",e,t,a)}function selectPlacesDB(e){var t="saved_places",a="lat,lng,name";return selectDB("wx_map",t,a,e)}function selectASavedPlaceDB(e){var t="saved_places",a="lat,lng,name",r=JSON.parse(e),i="lat='"+r[0]+"' and lng='"+r[1]+"'",o=selectDB("wx_map",t,a,i);return null!=o&&o.length>0?o[0]:null}function isSavedPlacesDB(e){var t=!1,a=selectASavedPlaceDB(e);return null!==a&&(t=!0),t}function addSavedPlaceDB(e){var t="saved_places(lat,lng,name) values(?,?,?)",a=[e.lat,e.lng,e.name];insertDB(t,a)}function addSavedPlaceMarkerDB(e){var t="saved_marker_id(lat,lng,id) values(?,?,?)",a=[e.lat,e.lng,e.id];insertDB(t,a)}function deleteSavedPlaceMarkerDB(e){deleteDB("saved_marker_id",e)}function selectASavedPlaceMarkerDB(e){var t="saved_marker_id",a="lat,lng,id",r=JSON.parse(e),i="lat='"+r[0]+"' and lng='"+r[1]+"'",o=selectDB("wx_map",t,a,i);return Ti.API.info("selectASavedPlaceMarkerDB()"+e+" db_record="+JSON.stringify(o)),null!=o&&o.length>0?o[0]:null}function removeSavedPlaceDB(e){var t="lat='"+e.lat+"' and lng='"+e.lng+"'";deleteDB("saved_places",t)}function updateSavedPlaceDB(e){var t;try{t=Ti.Database.open("wx_map");var a=[e.lat,e.lng];t.execute("update saved_places where lat=? and lng=?",a)}finally{null!==t&&t.close()}Ti.API.info("removeSavedPlaceDB():"+JSON.stringify(e))}function deleteDB(e,t){var a;try{a=Ti.Database.open("wx_map");var r="delete from "+e+" where "+t;Ti.API.info("deleteDB()sql:"+r),a.execute(r)}finally{null!==a&&a.close()}}function insertDB(e,t){var a;try{a=Ti.Database.open("wx_map"),a.execute("insert into "+e,t)}finally{null!==a&&a.close()}}function selectDB(e,t,a,r){var i,o=[],n=a.split(",");try{i=Ti.Database.open(e);var s="select "+a+" from "+t+" where "+r;Ti.API.info("selectDB="+s);var l=i.execute(s);if(l.rowCount<1)return null;for(;l.isValidRow();){for(var c={},d=0;d<n.length;d++)c[n[d]]=l.fieldByName(n[d]);o.push(c),l.next()}}finally{null!==l&&l.close(),null!==i&&i.close()}return o}