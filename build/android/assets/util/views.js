function createSuggestList(e,t){clearSuggestList(),showSuggestList();var i=(AllViews.searchBar,findOrCreateSearchList()),a=[],r=createGoogleListSection(e,t);Ti.API.info("createSuggestList().listSection.created"),a.push(r),i.sections=a,showSuggestList(),win.add(i)}function findOrCreateSearchList(){var e=AllViews.searchList;if("undefined"==typeof e){var t=createSearchListItemTemplate(),e=Ti.UI.createListView({top:"50dp",left:10,width:"80%",height:Ti.UI.SIZE,backgroundColor:"rgba(64,64,64,64)",templates:{plain:t},defaultItemTemplate:"plain"});e.addEventListener("itemclick",function(e){if("rowtitle"==e.bindId||"pic"==e.bindId){var t=e.section.getItemAt(e.itemIndex);Ti.API.info("suggest.list.clicked :"+JSON.stringify(t)),"undefined"!=typeof t.rowtitle.id&&(changeDestination(JSON.parse(t.rowtitle.id)),animateTo(JSON.parse(t.rowtitle.id))),hideSuggestList()}hideKeyboard()}),AllViews.searchList=e}return e}function createGoogleListSection(e,t){for(var i=Ti.UI.createListSection({headerTitle:t,width:Ti.UI.FILL}),a=[],r=0;r<e.length;r++){var n=e[r].point,o=getCurrentPos(),s=distance(n[0],n[1],o[0],o[1]),l=s>999?(s/1e3).toFixed(1)+" km":s+" m",d={pic:{image:Ti.App.Android.R.drawable.place_32.png},rowtitle:{text:e[r].addr,id:JSON.stringify(e[r].point),color:"black"},dist:{text:l,color:"black"},properties:{backgroundColor:"rgba(128,128,128,128)",height:"50dp"}};a.push(d)}return i.setItems(a),i}function createSearchListItemTemplate(){var e={childTemplates:[{type:"Ti.UI.ImageView",bindId:"pic",properties:{left:"2dp",image:Ti.App.Android.R.drawable.place_32.png}},{type:"Ti.UI.Label",bindId:"rowtitle",properties:{left:"10dp",font:{fontSize:14}}},{type:"Ti.UI.Label",bindId:"dist",properties:{right:"10dp",font:{fontSize:14}}}]};return e}function clearSuggestList(){var e=AllViews.searchList;"undefined"!=typeof e&&e.removeAllChildren()}function hideSuggestList(){var e=AllViews.searchList;"undefined"!=typeof e&&e.hide()}function showSuggestList(){var e=AllViews.searchList;"undefined"!=typeof e&&e.show()}function hideKeyboard(){var e=AllViews.searchBar;"undefined"!=typeof e&&e.blur()}function createAndroidSearchBar(){var e,t=Ti.Platform.displayCaps.platformWidth,i=Ti.Platform.displayCaps.logicalDensityFactor,a=parseInt(t/(i||1),10),r=Ti.UI.Android.createSearchView({backgroundColor:"rgba(128,128,128,128)",color:"black",width:a-160,height:"52dp",top:0,left:50}),n=function(t){clearTimeout(e),e=setTimeout(function(){if(Ti.API.info("search:"+t.source.value),t.source.value.length>1){searchOfflinePOI(t.source.value,"nz")}else hideSuggestList()},1e3)};r.addEventListener("change",n),r.addEventListener("submit",n),AllViews.searchBar=r,win.add(r)}function createIosSearchBar(){var e=Titanium.UI.createSearchBar({width:"80%",showCancel:!0,height:45,top:5,left:10});Ti.API.info("searchbar created"),win.add(e)}