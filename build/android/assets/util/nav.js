function initNav(e){e.load(Ti.App.id+"/gh/nz/")}function getDestinatePos(){var e=Ti.App.Properties.getDouble("dest_lat",0),i=Ti.App.Properties.getDouble("dest_lng",0);return[e,i]}function setDestinatePos(e){Ti.App.Properties.setDouble("dest_lat",e[0]),Ti.App.Properties.setDouble("dest_lng",e[1])}function navi(e,i,t){ROUTING=!0;var n=Ti.App.Properties.getString("by"),o={vehicle:n,from:i,to:t};e.getRouteAsyncCallback(o,function(e){0==e.error?isGoogleMap()?drawGHonGMap(e):drawGHonMapsforge(e):Ti.API.info("navi error:"+e.errmsg),ROUTING=!1})}function drawGHonGMap(e){removePrevRoute();var i={id:"route",points:e.pts,color:"blue",width:10};addMyGooglePolyline(i),saveRouteInfo(e.nodes),addNodeMarkers(),setNaviMode(1),win.setKeepScreenOn(!0),setEmptyPlayedList(e.nodes)}function drawGHonMapsforge(e){removePrevRoute();var i=addPolylineMF(e.pts,"blue",10);savePolylineId(i),saveRouteInfo(e.nodes),addNodeMarkers(),setNaviMode(1),win.setKeepScreenOn(!0),setEmptyPlayedList(e.nodes)}function naviGoogle(e,i,t){var n=Ti.Network.createHTTPClient(),o="http://maps.googleapis.com/maps/api/directions/json?sensor=false&",a=o+"origin="+i[0]+","+i[1]+"&destination="+t[0]+","+t[1];Ti.API.info(a),n.open("GET",a),n.onload=function(){var i=JSON.parse(this.responseText);if(i.routes.length>0){var t=createRouteDataGoogle(i),n=e.createRoute({name:"navi",points:t,color:"red",width:10});Ti.API.info("googleRoute.onload:"+t.length),addGoogleRoute(n)}},n.send()}var ROUTING=!1,createRouteDataGoogle=function(e){var i,t=e.routes[0].overview_polyline.points,n=[],o=0,a=0;for(i=decodeLineGoogle(t),a=i.length,o=0;a>o;o+=1)null!=i[o]&&n.push({latitude:i[o][0],longitude:i[o][1]});return n},decodeLineGoogle=function(e){for(var i=e.length,t=0,n=[],o=0,a=0;i>t;){var r,l=0,d=0;do r=e.charCodeAt(t++)-63,d|=(31&r)<<l,l+=5;while(r>=32);var s=1&d?~(d>>1):d>>1;o+=s,l=0,d=0;do r=e.charCodeAt(t++)-63,d|=(31&r)<<l,l+=5;while(r>=32);var c=1&d?~(d>>1):d>>1;a+=c,n.push([1e-5*o,1e-5*a])}return n};